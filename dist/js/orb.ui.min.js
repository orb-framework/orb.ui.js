!function e(t,i,o){function n(l,r){if(!i[l]){if(!t[l]){var a="function"==typeof require&&require;if(!r&&a)return a(l,!0);if(s)return s(l,!0);var u=new Error("Cannot find module '"+l+"'");throw u.code="MODULE_NOT_FOUND",u}var d=i[l]={exports:{}};t[l][0].call(d.exports,function(e){var i=t[l][1][e];return n(i?i:e)},d,d.exports,e,t,i,o)}return i[l].exports}for(var s="function"==typeof require&&require,l=0;l<o.length;l++)n(o[l]);return n}({1:[function(e,t,i){window.orb=window.orb||{},window.orb.ui=window.orb.ui=new Backbone.Model({shiftKey:!1,metaKey:!1,altKey:!1,ctrlKey:!1}),e("./querybuilder/all"),e("./editor/all"),e("./modelpicker"),e("./table"),$(document).mousemove(function(e){var t=$(".orb");e.shiftKey?(t.addClass("shift-pressed"),orb.ui.set("shiftKey",!0)):(t.removeClass("shift-pressed"),orb.ui.set("shiftKey",!1)),e.metaKey?(t.addClass("meta-pressed"),orb.ui.set("metaKey",!0)):(t.removeClass("meta-pressed"),orb.ui.set("metaKey",!1)),e.altKey?(t.addClass("alt-pressed"),orb.ui.set("altKey",!0)):(t.removeClass("alt-pressed"),orb.ui.set("altKey",!1)),e.controlKey?(t.addClass("ctrl-pressed"),orb.ui.set("ctrlKey",!0)):(t.removeClass("ctrl-pressed"),orb.ui.set("ctrlKey",!1))})},{"./editor/all":2,"./modelpicker":4,"./querybuilder/all":5,"./table":9}],2:[function(e,t,i){e("./editor")},{"./editor":3}],3:[function(e,t,i){!function(e){e.ui.Toolbar=Marionette.LayoutView.extend({tagName:"div",attributes:{"class":"orb-toolbar form form-inline",role:"form"},template:_.template('<div id="picker-container" class="form-group"></div><div class="form-group"><input class="form-control input-sm" placeholder="quick search..."/></div><span class="pull-right"><div class="form-group"><div class="btn-group btn-group-sm"><button id="add-btn" class="btn btn-default"><i class="fa fa-plus"></i></button><button id="edit-btn" class="btn btn-default"><i class="fa fa-edit"></i></button><button id="remove-btn" class="btn btn-default"><i class="fa fa-remove"></i></button></div></div>&nbsp;<div class="form-group"><div class="btn-group btn-group-sm"><button id="config-btn" class="btn btn-default"><i class="fa fa-gear"></i></button></div></div></span>'),regions:{pickerContainer:"#picker-container"},events:{"click #config-btn":"configure"},configure:function(t){if(t.preventDefault(),t.stopPropagation(),this.queryBuilder)this.queryBuilderVisible?(this.rebuild(),this.$("#config-btn").popover("hide"),this.queryBuilderVisible=!1):(this.$("#config-btn").popover("show"),this.queryBuilderVisible=!0);else{this.query=new e.QCompound,this.queryBuilder=new e.ui.QueryBuilder({modelType:this.modelType,collection:this.query.queries});var i='<div class="popover orb-query-popover" style="min-width:800px;max-width:800px" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>';this.queryBuilder.render(),this.$("#config-btn").popover({trigger:"manual",content:this.queryBuilder.$el,html:!0,placement:"left",container:"body",template:i}),this.$("#config-btn").popover("show"),this.queryBuilderVisible=!0}},initialize:function(e){e=e||{},this.modelType=e.modelType,this.collection=e.collection},onRender:function(){this.picker=new e.ui.ModelPicker({scope:this.modelType.schema.referenceScope,modelType:this.modelType}),this.pickerContainer.show(this.picker);var t=this;this.listenTo(this.picker,"change",function(){t.queryBuilder&&(t.queryBuilder.destroy(),t.queryBuilder=void 0,t.query=void 0,t.queryBuilderVisible=!1,t.$("#config-btn").popover("destroy")),t.rebuild()})},rebuild:function(){this.modelType=this.picker.modelType,this.collection=this.modelType.select({where:this.query}),this.trigger("change")}}),e.ui.Editor=Marionette.LayoutView.extend({tagName:"div",attributes:{"class":"orb-editor container-fluid"},template:_.template('<div id="toolbar-container" class="col-md-12"></div><div id="table-container" class="col-md-12"></div>'),regions:{toolbarContainer:"#toolbar-container",tableContainer:"#table-container"},initialize:function(e){if(e=e||{},e.collection)this.collection=e.collection,this.modelType=this.collection.model,this.schema=this.modelType.schema;else{if(!e.modelType)throw"Invalid properties to Table";this.modelType=e.modelType,this.schema=this.modelType.schema,this.collection=e.modelType.all()}},onRender:function(){this.toolbar=new e.ui.Toolbar({modelType:this.modelType,collection:this.collection}),this.toolbarContainer.show(this.toolbar),this.tableContainer.show(new e.ui.Table({filter:!1,collection:this.collection}));var t=this;this.listenTo(this.toolbar,"change",function(){t.rebuild()})},rebuild:function(){this.tableContainer.show(new e.ui.Table({filter:!1,collection:this.toolbar.collection}))}})}(window.orb)},{}],4:[function(e,t,i){!function(e){e.ui.ModelPicker=Marionette.ItemView.extend({tagName:"select",attributes:{"class":"form-control input-sm selectpicker"},template:_.template('<% _.each(scope, function (model) { %><% if (model.schema !== undefined) { %><option value="<%- model.schema.model %>" <%- (model === modelType) ? "selected" : "" %>><%- model.schema.model %></option><% } %><% }) %>'),events:{change:"update"},initialize:function(e){e=e||{},this.referenceScope=e.scope,this.modelType=e.modelType},templateHelpers:function(){return{scope:this.referenceScope,modelType:this.modelType}},update:function(){this.modelType=this.referenceScope[this.$el.val()],this.trigger("change")}})}(window.orb)},{}],5:[function(e,t,i){e("./querybuilder"),e("./editors"),e("./rules")},{"./editors":6,"./querybuilder":7,"./rules":8}],6:[function(e,t,i){!function(e){e.ui.QueryBuilder.Editors.InputField=Marionette.ItemView.extend({tagName:"span",template:_.template('<input id="edit" class="form-control input-sm input-block" value="<%- value %>" placeholder="<%- placeholder %>" type="text"/>'),events:{"change input":"updateValue"},initialize:function(e){e=e||{},this.placeholder=e.placeholder},templateHelpers:function(){return{placeholder:this.placeholder}},updateValue:function(){this.model.set("value",this.$("input").val())}}),e.ui.QueryBuilder.Editors.SelectField=Marionette.ItemView.extend({tagName:"select",attributes:{"class":"form-control input-sm selectpicker"},template:_.template('<% _.each(options, function (option) { %><option value="<%- option.value %>"><%- option.display %></option><% }); %>'),events:{change:"updateValue"},initialize:function(e){this.options=e},templateHelpers:function(){return this.options},updateValue:function(){this.model.set("value",this.val())}}),e.ui.QueryBuilder.Editors.DateField=Marionette.ItemView.extend({tagName:"span",template:_.template('<input class="form-control input-sm" value="<%- value %>" type="date"/>'),events:{"change input":"updateValue"},updateValue:function(){this.model.set("value",this.$("input").val())}}),e.ui.QueryBuilder.Editors.BetweenField=Marionette.ItemView.extend({tagName:"span",template:_.template('<input class="form-control input-sm" value="<%- value %>" type="date"/><input class="form-control input-sm" value="<%- value %>" type="date"/>')})}(window.orb,window.Marionette)},{}],7:[function(e,t,i){!function(e,t,i){e.ui.QueryItem=t.LayoutView.extend({tagName:"li",model:e.Query,attributes:{"class":"query-item"},template:_.template('<div class="form-group item-content"><div class="selector"></div><button class="btn btn-default action-btn btn-sm" data-action="removed"><strong>&times;</strong></button><span class="editor-area"><select id="column-ddl" class="form-control input-sm"><% _.each(schema.columns, function (col) { %><option value="<%- col.field %>"><%- col.display %></option><% }); %></select><select id="rule-ddl" class="form-control input-sm"></select><span class="item-editor"></span></span><div class="btn-group switch-btn-group btn-group-sm pull-right"><div class="btn btn-default action-btn <%- (parent_op == "and") ? "selected" : "active" %>"data-action="switch" data-action-value="and" data-action-toggle="true">And</div><div class="btn btn-default action-btn <%- (parent_op == "or") ? "selected" : "active" %>"data-action="switch" data-action-value="or" data-action-toggle="true">Or</div></div></div>'),regions:{editor:".item-editor"},events:{"change #column-ddl":"loadRules","change #rule-ddl":"assignEditor","click > .item-content .action-btn":"triggerAction","click .selector":"toggleSelected"},assignEditor:function(t,i){i=i||{},i.column||(i.column=this.currentColumn());var o=e.ui.QueryBuilder.Rules[i.column.type]||{},n=o[this.$("#rule-ddl option:selected").text()]||{};n.editor?(this.model.set("op",n.op),this.editor.show(new n.editor(_.extend({},{model:this.model},n.options)))):(this.$(".item-editor").empty(),this.model.set("value",n.value))},currentColumn:function(){return this.schema.columns[this.$("#column-ddl").val()]},initialize:function(e){var t=this;t.schema=e.schema,t.parentModel=e.parentModel},onRender:function(){this.loadRules({},{column:this.schema.columns[this.model.get("column")],op:this.model.get("op"),value:this.model.get("value")})},loadRules:function(t,i){var o=this;i=i||{},i.column?this.$("#column-ddl").val(i.column.field):(i.column=this.currentColumn(),this.model.set("column",i.column.field)),i.op||(i.op=e.Q.Op.Is);var n=e.ui.QueryBuilder.Rules[i.column.type],s=this.$("#rule-ddl");s.empty(),_.each(n,function(e,t){var n=void 0;n=e.matches?e.matches(o.model):e.op==i.op,s.append('<option "'+t+'" '+(n?"selected":"")+">"+t+"</option")}),this.assignEditor({},i)},toggleSelected:function(e){this.$(".selector").toggleClass("selected")},triggerAction:function(e){var t=i(e.currentTarget),o=t.data("action"),n=t.data("actionValue"),s=t.data("actionToggle");if(s){var l=this.$('[data-action="'+o+'"]');l.addClass("active"),t.removeClass("active"),this.trigger("action:"+o,n)}else this.trigger("action:"+o,n)},templateHelpers:function(){var e=this.model.get("column")||_.keys(this.schema.columns)[0],t=(this.schema.columns[e],{schema:this.schema,parent_op:this.parentModel.get("op")});return t}}),e.ui.QueryCompoundItem=t.LayoutView.extend({tagName:"li",model:e.QueryCompound,attributes:{"class":"query-item query-compound-item"},template:_.template('<div class="form-group item-content"><div class="selector"></div><button class="btn btn-default btn-sm action-btn" data-action="removed"><strong>&times;</strong></button><span class="editor-area"><em><a href="#" class="text-muted toggle-link"><i class="fa fa-sm fa-caret-right"></i>&nbsp;&nbsp;Query Group</a></em></span><div class="btn-group switch-btn-group btn-group-sm pull-right"><div class="btn btn-default action-btn <%- (parent_op == "and") ? "selected" : "active" %>"data-action="switch" data-action-value="and" data-action-toggle="true">And</div><div class="btn btn-default action-btn <%- (parent_op == "or") ? "selected" : "active" %>"data-action="switch" data-action-value="or" data-action-toggle="true">Or</div></div></div><div id="sub-query-container" class="form-group"></div>'),regions:{subQueryContainer:"#sub-query-container"},events:{"change #column-ddl":"loadRules","change #rule-ddl":"assignEditor","click > .item-content .action-btn":"triggerAction","click .selector":"toggleSelected","click > .item-content .toggle-link":"toggleGroup"},initialize:function(e){var t=this;t.expanded=!1,t.schema=e.schema,t.parentModel=e.parentModel},toggleGroup:function(){var t=this,i=this.$("> .item-content .toggle-link"),o=i.find("i");if(this.expanded)o.addClass("fa-caret-right"),o.removeClass("fa-caret-down"),this.subQueryContainer.empty();else{o.removeClass("fa-caret-right"),o.addClass("fa-caret-down");var n=new e.ui.QueryBuilder({schema:t.schema,model:t.model,nested:!0});this.subQueryContainer.show(n)}this.expanded=!this.expanded},templateHelpers:function(){var t=this.model.column||_.keys(this.schema.columns)[0],i=this.schema.columns[t],o={schema:this.schema,rules:e.ui.QueryBuilder.Rules[i.type],parent_op:this.parentModel.get("op")};return o},triggerAction:function(e){var t=i(e.currentTarget),o=t.data("action"),n=t.data("actionValue"),s=t.data("actionToggle");if(s){var l=this.$('> item-content [data-action="'+o+'"]');l.addClass("active"),t.removeClass("active"),this.trigger("action:"+o,n)}else this.trigger("action:"+o,n)}}),e.ui.QueryBuilder=t.CompositeView.extend({tagName:"div",attributes:{"class":"querybuilder form form-inline",role:"form"},childView:function(t){return t.model instanceof e.Q?new e.ui.QueryItem(t):new e.ui.QueryCompoundItem(t)},childViewContainer:".query-items",childViewOptions:function(){return{schema:this.schema,parentModel:this.model}},childEvents:{"action:switch":"switchOp","action:removed":"removeQuery"},template:_.template('<ul class="list-unstyled query-items"></ul><% if (!nested) { %><div class="help"><small class="text-muted"><em>Hold ctrl or meta key to select and group queries.</em></small></div><% } %>'),initialize:function(t){var o=this;t=t||{},t.modelType?this.schema=t.modelType.schema:this.schema=t.schema,this.model||(this.model=new e.QCompound),this.modelType=t.modelType||void 0,this.nested=t.nested,this.collection=t.collection||this.model.queries,this.collection.isEmpty()&&this.collection.add(new e.Q),o.listenTo(e.ui,"change:metaKey",function(t,n){if(!n){var s=o.$("> .query-items > .query-item > .item-content .selector.selected");s.removeClass("selected");var l=[];if(s.each(function(e,t){var n=i(t).closest("li"),s=o.collection.at(n.index());l.push(s)}),l.length>1){var r=new e.QCompound({op:o.model.get("op"),queries:new Backbone.Collection(l)});this.model.queries.remove(l),this.model.queries.add(r)}}})},removeQuery:function(e){this.collection.length>1&&this.collection.remove(e.model)},switchOp:function(t,o){this.model.get("op")!==o?(this.model.set("op",o),1===this.collection.length&&this.collection.add(new e.Q)):this.collection.add(new e.Q),this.$('> .query-items > .query-item > .item-content .action-btn[data-action="switch"]').each(function(e,t){var n=i(t);n.data("action-value")===o?n.removeClass("active").addClass("selected"):n.removeClass("selected").addClass("active")})},templateHelpers:function(){return{nested:this.nested}}},{Editors:{},Rules:{}})}(window.orb,window.Marionette,$)},{}],8:[function(e,t,i){!function(e){var t={"is null":{op:e.Q.Op.Is,value:null,matches:function(t){return t.get("op")===e.Q.Op.Is&&null===t.get("value")}},"is not null":{op:e.Q.Op.IsNot,value:null,matches:function(t){return t.get("op")===e.Q.Op.IsNot&&null===t.get("value")}}},i={is:{op:e.Q.Op.Is,editor:e.ui.QueryBuilder.Editors.InputField},"is not":{op:e.Q.Op.IsNot,editor:e.ui.QueryBuilder.Editors.InputField}},o={contains:{op:e.Q.Op.Contains,editor:e.ui.QueryBuilder.Editors.InputField},"does not contain":{op:e.Q.Op.DoesNotContain,editor:e.ui.QueryBuilder.Editors.InputField},"starts with":{op:e.Q.Op.Startswith,editor:e.ui.QueryBuilder.Editors.InputField},"does not start with":{op:e.Q.Op.DoesNotStartwith,editor:e.ui.QueryBuilder.Editors.InputField},"ends with":{op:e.Q.Op.Startswith,editor:e.ui.QueryBuilder.Editors.InputField},"does not end with":{op:e.Q.Op.DoesNotEndwith,editor:e.ui.QueryBuilder.Editors.InputField},matches:{op:e.Q.Op.Matches,editor:e.ui.QueryBuilder.Editors.InputField},"does not match":{op:e.Q.Op.DoesNotMatch,editor:e.ui.QueryBuilder.Editors.InputField}},n={is:{op:e.Q.Op.Is,editor:e.ui.QueryBuilder.Editors.SelectField,options:{options:[{value:"true",display:"True"},{value:"false",display:"False"}]}},"is not":{op:e.Q.Op.Is,editor:e.ui.QueryBuilder.Editors.SelectField,options:{options:[{value:"true",display:"True"},{value:"false",display:"False"}]}}},s={is:{op:e.Q.Op.Is,editor:e.ui.QueryBuilder.Editors.DateField},"is not":{op:e.Q.Op.Is,editor:e.ui.QueryBuilder.Editors.DateField},after:{op:e.Q.Op.After,editor:e.ui.QueryBuilder.Editors.DateField},before:{op:e.Q.Op.Before,editor:e.ui.QueryBuilder.Editors.DateField},between:{op:e.Q.Op.Between,editor:e.ui.QueryBuilder.Editors.BetweenField}},l={is:{op:e.Q.Op.Is,editor:e.ui.QueryBuilder.Editors.InputField}};e.ui.QueryBuilder.Rules.Id=_.extend({},i,t),e.ui.QueryBuilder.Rules.Boolean=_.extend({},n,t),e.ui.QueryBuilder.Rules.String=_.extend({},i,t,o),e.ui.QueryBuilder.Rules.Email=_.extend({},i,t,o),e.ui.QueryBuilder.Rules.Text=_.extend({},i,t,o),e.ui.QueryBuilder.Rules.Html=_.extend({},i,t,o),e.ui.QueryBuilder.Rules.Xml=_.extend({},i,t,o),e.ui.QueryBuilder.Rules.Date=_.extend({},s),e.ui.QueryBuilder.Rules.Datetime=_.extend({},s),e.ui.QueryBuilder.Rules.DatetimeWithTimezone=_.extend({},s),e.ui.QueryBuilder.Rules.Reference=_.extend({},l,t)}(window.orb)},{}],9:[function(e,t,i){!function(e){e.ui.Table=Marionette.ItemView.extend({tagName:"div",attributes:{"class":"table table-striped orb-table"},template:_.template('<table class="table table-striped"><% if (showHeader) { %><thead><tr><% _.each(columns, function (column) { %><th><%= column.display %></th><% }); %></tr></thead><% } %><% if (showFooter) { %><tfoot><tr><% _.each(columns, function (column) { %><th><%= column.display %></th><% }); %></tr></tfoot><% } %><tbody></tbody></table>'),collectData:function(){var e=[];return this.collection.each(function(t){e.push(t.attributes)}),e},getColumns:function(){var e=[];return this.schema&&_.each(this.schema.columns,function(t){e.push({data:t.field,display:t.display})}),e},getColumnDefs:function(e){var t=[],i=this;return _.each(e,function(e,o){if(e.renderer){var n=e.renderer,s=e.data,l=e.rendererOptions;t.push({targets:o,data:s,render:function(e,t,o,r){if("display"===t){var a=i[n](e,t,o,r,l);if("string"==typeof a)return a;var u=s+"_"+r.row;return i.renderers[u]=a,'<span id="'+u+'" class="renderer-container waiting"></span>'}return e}})}}),t},getExportData:function(e,t){return e.attributes[t]},initialize:function(e){if(e=e||{},e.collection)this.collection=e.collection,this.modelType=this.collection.model,this.schema=this.modelType.schema;else{if(!e.modelType)throw"Invalid properties to Table";this.modelType=e.modelType,this.schema=this.modelType.schema,this.collection=e.modelType.all()}this.table=void 0,this.renderers={},this.columns=e.columns||this.getColumns(),this.columnFilter=e.columnFilter||void 0,this.paginate=void 0===e.paginate?!0:e.paginate,this.sort=void 0===e.sort?!0:e.sort,this.filter=e.filter||!0,this.rowHeight=e.rowHeight||60,this.maxVisibleRows=e.maxVisibleRows||10,this.maxHeight=e.maxHeight||this.rowHeight*this.maxVisibleRows,this.showHeader=e.showHeader||!0,this.showFooter=e.showFooter||!1,this.options=e.options||{}},onRowRender:function(e,t,i){var o=this;$(e).find(".renderer-container.waiting").each(function(){var e=$(this);e.removeClass("waiting");var t=o.renderers[e.attr("id")];t instanceof jQuery?e.append(t):(t.render(),e.append(t.$el))})},onLoad:function(){},onRender:function(){var e=this,t={scrollY:this.maxHeight,scrollX:!0,scrollCollapse:!0,stateSave:!0,processing:!0,lengthChange:!0,filter:this.filter,info:!0,deferRender:!0,scroller:{rowHeight:this.rowHeight,displayBuffer:2},columns:this.columns,columnDefs:this.columnDefs,paginate:this.paginate,sort:this.sort,dom:"ZTrtiS",rowCallback:function(t,i,o){return e.onRowRender(t,i,o)},ajax:function(t,i,o){var n=Date.now();return e.collection.fetch({success:function(t){var o=Date.now();console.log("Query took "+(o-n)+"ms"),i({data:e.collectData()}),e.onLoad()}})}},i=this.$("table");this.table=i.DataTable(_.extend(t,e.options))},refresh:function(){this.table.ajax.reload()},rowCount:function(){var e=this.table.page.info();return e.recordsTotal},search:function(e){this.table.search(e)},unfilteredRowCount:function(){var e=this.table.page.info();return e.recordsDisplay},templateHelpers:function(){return{columns:this.columns,showHeader:this.showHeader,showFooter:this.showFooter}}})}(window.orb)},{}]},{},[1]);
